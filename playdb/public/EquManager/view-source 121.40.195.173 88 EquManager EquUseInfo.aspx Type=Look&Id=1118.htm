

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title></title>
    <!--框架必需start-->
    <script type="text/javascript" src="../libs/js/jquery.js"></script>
    <script type="text/javascript" src="../libs/js/language/cn.js"></script>
    <script type="text/javascript" src="../libs/js/framework.js"></script>
    <link href="../libs/css/import_basic.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" id="skin" prepath="../" />
    <link rel="stylesheet" type="text/css" id="customSkin" />
    <!--框架必需end-->
    <!-- 日期控件start -->
    <script type="text/javascript" src="../libs/js/form/datePicker/WdatePicker.js"></script>
    <!-- 日期控件end -->
    <!-- 树组件start -->
    <script type="text/javascript" src="../libs/js/tree/ztree/ztree.js"></script>
    <link type="text/css" rel="stylesheet" href="../libs/js/tree/ztree/ztree.css"></link>
    <!-- 树组件end -->
    <!-- 树形下拉框start -->
    <script type="text/javascript" src="../libs/js/form/selectTree.js"></script>
    <!-- 树形下拉框end -->
    <!-- 表单验证start -->
    <script src="../libs/js/form/validationRule.js" type="text/javascript"></script>
    <script src="../libs/js/form/validation.js" type="text/javascript"></script>
    <!-- 表单验证end -->
    <!--基本选项卡start-->
    <script type="text/javascript" src="../libs/js/nav/basicTab.js"></script>
    <!--基本选项卡end-->
    <script type="text/javascript">
        function lookupEqu() {
            top.Dialog.open({
                URL: "SearchPage/SelectEqument.aspx?IsMultiple=true",
                Title: "选择医院设备",
                ShowMaxButton: true,
                Width: 950,
                Height: 600
            });
        }
        function setvalue(rows) {
            if (rows.length > 0) {
                var $grid = $("#gvEquUse");
                $(rows).each(function (i) {
                    var ename = rows[i].EquName;
                    var serianum = rows[i].Specification;
                    var deptname = rows[i].DeptName;
                    var ibnum = rows[i].IBNumber;
                    var DepartmentID = rows[i].DepartmentID;

                    var $tr = $grid.find("tr:has(td):first").clone(true);
                    $tds = $tr.find("td");
                    $tds.eq(0).find(".equname").text(ename);
                    $tds.eq(0).find(".pkey").val("0");
                    $tds.eq(0).find(".DepartmentID").val(DepartmentID);
                    $tds.eq(1).text(serianum);
                    $tds.eq(2).text(ibnum);
                    $tds.eq(3).text(deptname);
                    $tds.eq(4).find(".txtUseProject").val("");
                    $tds.eq(5).find(".UseNum").val("");
                    $tds.eq(6).find(".UseMoney").val("");
                    $grid.append($tr.css("display", "block"));
                })
                var equname = $grid.find("tr:has(td):first").find("td").eq(0).find(".equname").text();
                if (equname == "") {
                    $grid.find("tr:has(td):first").css("display", "none");
                }
            }
        }
        function saveGrid() {
            var $grid = $("#gvEquUse");
            var list = [];
            $grid.find("tr:has(td):visible").each(function (i, row) {
                var entity = new Object();
                entity.Id = $(row).find(".pkey").val();
                entity.IBNumber = $(row).find("td").eq(2).text();
                entity.DepId = $(row).find("#DepartmentID").val();

                entity.UseDate = $(row).find(".UseDate").val();
                entity.UseProject = $(row).find(".UseProject").val();
                entity.UseNum = $(row).find(".UseNum").val();
                entity.UseMoney = $(row).find(".UseMoney").val();
                entity.CreateName = '系统管理员';
                entity.CreateTime = '2016/1/11 14:34:24';

                list.push(entity);
            });

            infoObj = JSON.stringify(list);
            $.ajax({
                type: 'POST',
                async: false,
                url: '../Handler/EquUsesRecord.ashx',
                dataType: 'json',
                data: {
                    type: "SaveEquUseData",
                    data: infoObj
                },
                success: function (result) {
                    top.frmright.page_260.refresh();
                    top.Dialog.close();
                },
                error: function (a) {
                    top.frmright.page_260.refresh();
                    top.Dialog.close();
                }
            });
        }
        function DeleteRow() {
            var tt = arguments[0];
            $(tt).parent().parent().css("display", "none");
            var id = $(tt).parent().parent().parent().find("td:first").find(".pkey").val();
            if (id != "0") {
                $.ajax({
                    type: 'POST',
                    async: false,
                    url: '../Handler/EquUsesRecord.ashx?type=DelEquUseData',
                    dataType: 'json',
                    data: {
                        id: id
                    },
                    success: function (result) {
                        // top.frmright.page_228.refresh();
                        //top.Dialog.close();
                    },
                    error: function (a) {
                        top.Dialog.alert("访问服务器端出错！");
                    }
                });
            }
        }

        function Sum(e) {
            var $currentRow = $(e.parentNode.parentNode);
            var UseNum = $currentRow.find('.UseNum').val();
            var UseMoney = $currentRow.find('.UseMoney').val();
            if (UseNum == "" || UseNum == null) {
                UseNum = 0;
            }
            if (UseMoney == "" || UseMoney == null) {
                UseMoney = 0;
            }
            var tax = eval(UseMoney) * eval(UseNum);
            $currentRow.find('.SumMoney').text(tax);
        }
    </script>
</head>
<body>
    <form method="post" action="EquUseInfo.aspx?Type=Look&amp;Id=1118" id="form1">
<div class="aspNetHidden">
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwULLTE3NDM2MDU1NTYPZBYCZg9kFggCAQ8WAh4IZGlzYWJsZWQFCGRpc2FibGVkZAIDDzwrABECAA8WBh4LXyFEYXRhQm91bmRnHgtfIUl0ZW1Db3VudAIBHgdFbmFibGVkaGQBEBYBAgkWATwrAAUBABYCHgdWaXNpYmxlaBYBAgYWAmYPZBYGAgEPZBYSZg9kFgQCAQ8PFgIeBFRleHQFD+mHkeWunemAj+aekOacumRkAgQPFQEFMzA1MDJkAgEPDxYCHwUFBEFLOTZkZAICDw8WAh8FBQ82ODQ1LTQxNTExMjA1MzJkZAIDDw8WAh8FBQnmo4Dpqoznp5FkZAIED2QWAgIBDw8WAh8FBRAyMDE2LTAxLTE1IDExOjIzZGQCBQ9kFgICAQ8PFgIfBWVkZAIGD2QWAgIBDw8WAh8FZWRkAgcPZBYCAgEPDxYCHwVlZGQCCA9kFgICAQ8PFgIfBQUEMC4wMGRkAgIPDxYCHwRoZGQCAw8PFgIfBGhkZAIFDxYCHwBkZAIHDxYCHwAFCGRpc2FibGVkZBgBBQhndkVxdVVzZQ88KwAMAQgCAWR3jQY6c8pIYB3Cu1OCjwHnHcf1XYX8g4dA15PpwtPd/A==" />
</div>

<div class="aspNetHidden">

	<input type="hidden" name="__EVENTVALIDATION" id="__EVENTVALIDATION" value="/wEWBgL97rkZAqG4ruMMAu3O2IQIAqGOocMMAouq8vYOAsvXrY0CQXHb7EToa97HzeD2MJNFzPcFrWr0XvmZ09kAi4YMmrQ=" />
</div>
    <div class="box1">
        <div class="box_tool_min padding_top2 padding_bottom2 padding_right5">
            <div class="center">
                <div class="left">
                    <div class="right">
                        <div class="padding_top5 padding_left10">
                            <a href="javascript: lookupEqu()" disabled="disabled"><span class="icon_add">选择设备</span></a>
                            <div class="box_tool_line">
                            </div>
                            
                            <div class="clear">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="clear">
            </div>
        </div>
        <div>
	<table class="aspNetDisabled tableStyle" cellspacing="0" id="gvEquUse" style="width:100%;border-collapse:collapse;">
		<tr>
			<th scope="col">设备名称</th><th scope="col">设备型号</th><th scope="col">系统编号</th><th scope="col">目前使用科室</th><th align="center" scope="col">使用时间</th><th scope="col">项目</th><th scope="col">使用次数</th><th scope="col">收费金额</th><th scope="col">合计</th>
		</tr><tr>
			<td>
                        <span id="gvEquUse_lblEquName_0" class="equname">金宝透析机</span>
                        <input name="gvEquUse$ctl02$hdPDID" type="hidden" id="gvEquUse_hdPDID_0" class="pkey" value="1118" />
                        <input type="hidden" class="DepartmentID" id="DepartmentID" value='30502' />
                    </td><td>AK96</td><td>6845-4151120532</td><td>检验科</td><td align="center">
                        <input name="gvEquUse$ctl02$txtUseDate" type="text" value="2016-01-15 11:23" disabled="disabled" id="gvEquUse_txtUseDate_0" class="UseDate date" dateFmt="yyyy-MM-dd HH:mm" style="width:100px;" />
                    </td><td>
                        <input name="gvEquUse$ctl02$txtUseProject" type="text" disabled="disabled" id="gvEquUse_txtUseProject_0" class="UseProject" />
                    </td><td>
                        <input name="gvEquUse$ctl02$txtUseNum" type="text" disabled="disabled" id="gvEquUse_txtUseNum_0" class="UseNum" onkeyup="Sum(this)" style="width:70px;" />
                    </td><td>
                        <input name="gvEquUse$ctl02$txtUseMoney" type="text" disabled="disabled" id="gvEquUse_txtUseMoney_0" class="UseMoney" onkeyup="Sum(this)" style="width:70px;" />
                    </td><td>
                        <span id="gvEquUse_lblSumMoney_0" class="SumMoney">0.00</span>
                    </td>
		</tr>
	</table>
</div>
        <table class="tableStyle" formmode="transparent">
            <tr>
                <td>
                    <button id="GoBack" type="button" onclick="top.Dialog.close();" style="float: right;
                        margin-right: 50px">
                        <span class="icon_exit">返回</span></button>
                    <button id="btnSave" type="button" onclick="saveGrid();" style="float: right;
                        margin-right: 30px" disabled="disabled">
                        <span class="icon_save">保存</span></button>
                </td>
            </tr>
        </table>
    </div>
    </form>
</body>
</html>
