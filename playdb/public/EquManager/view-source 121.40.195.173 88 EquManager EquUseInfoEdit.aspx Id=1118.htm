

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title></title>
    <!--框架必需start-->
    <script type="text/javascript" src="../libs/js/jquery.js"></script>
    <script type="text/javascript" src="../libs/js/language/cn.js"></script>
    <script type="text/javascript" src="../libs/js/framework.js"></script>
    <link href="../libs/css/import_basic.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" id="skin" prepath="../" />
    <link rel="stylesheet" type="text/css" id="customSkin" />
    <!--框架必需end-->
    <!-- 日期控件start -->
    <script type="text/javascript" src="../libs/js/form/datePicker/WdatePicker.js"></script>
    <!-- 日期控件end -->
    <!-- 树组件start -->
    <script type="text/javascript" src="../libs/js/tree/ztree/ztree.js"></script>
    <link type="text/css" rel="stylesheet" href="../libs/js/tree/ztree/ztree.css"></link>
    <!-- 树组件end -->
    <!-- 树形下拉框start -->
    <script type="text/javascript" src="../libs/js/form/selectTree.js"></script>
    <!-- 树形下拉框end -->
    <!-- 表单验证start -->
    <script src="../libs/js/form/validationRule.js" type="text/javascript"></script>
    <script src="../libs/js/form/validation.js" type="text/javascript"></script>
    <!-- 表单验证end -->
    <!--基本选项卡start-->
    <script type="text/javascript" src="../libs/js/nav/basicTab.js"></script>
    <!--基本选项卡end-->
    <script type="text/javascript">

        function saveGrid() {
            var $grid = $("#gvEquUse");
            var list = [];
            $grid.find("tr:has(td):visible").each(function (i, row) {
                var entity = new Object();
                entity.Id = $(row).find(".pkey").val();
                entity.IBNumber = $(row).find("td").eq(2).text();
                entity.DepId = $(row).find("#DepartmentID").val();

                entity.UseDate = $(row).find(".UseDate").val();
                entity.UseProject = $(row).find(".UseProject").val();
                entity.UseNum = $(row).find(".UseNum").val();
                entity.UseMoney = $(row).find(".UseMoney").val();
                entity.CreateName = '系统管理员';
                entity.CreateTime = '2016/1/11 14:34:38';

                list.push(entity);
            });

            infoObj = JSON.stringify(list);
            $.ajax({
                type: 'POST',
                async: false,
                url: '../Handler/EquUsesRecord.ashx',
                dataType: 'json',
                data: {
                    type: "SaveEquUseData",
                    data: infoObj
                },
                success: function (result) {
                    top.frmright.page_260.refresh();
                    top.Dialog.close();
                },
                error: function (a) {
                    top.frmright.page_260.refresh();
                    top.Dialog.close();
                }
            });
        }

        function Sum(e) {
            var $currentRow = $(e.parentNode.parentNode);
            var UseNum = $currentRow.find('.UseNum').val();
            var UseMoney = $currentRow.find('.UseMoney').val();
            if (UseNum == "" || UseNum == null) {
                UseNum = 0;
            }
            if (UseMoney == "" || UseMoney == null) {
                UseMoney = 0;
            }
            var tax = eval(UseMoney) * eval(UseNum);
            $currentRow.find('.SumMoney').text(tax);
        }
    </script>
</head>
<body>
    <form method="post" action="EquUseInfoEdit.aspx?Id=1118" id="form1">
<div class="aspNetHidden">
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwUKMTg0NDk2ODMyNA9kFgJmD2QWAgIBDzwrABECAA8WBB4LXyFEYXRhQm91bmRnHgtfIUl0ZW1Db3VudAIBZAEQFgAWABYAFgJmD2QWBgIBD2QWCmYPZBYEAgEPDxYCHgRUZXh0BQ/ph5Hlrp3pgI/mnpDmnLpkZAIEDxUBBTMwNTAyZAIBDw8WAh8CBQRBSzk2ZGQCAg8PFgIfAgUPNjg0NS00MTUxMTIwNTMyZGQCAw8PFgIfAgUJ5qOA6aqM56eRZGQCCA9kFgICAQ8PFgIfAgUEMC4wMGRkAgIPDxYCHgdWaXNpYmxlaGRkAgMPDxYCHwNoZGQYAQUIZ3ZFcXVVc2UPPCsADAEIAgFkC2PnqeW/spGuLmUTL19UtsOHM9q1+G/3OS62pp/qAy0=" />
</div>

<div class="aspNetHidden">

	<input type="hidden" name="__EVENTVALIDATION" id="__EVENTVALIDATION" value="/wEWBgLyzrrhBgKhuK7jDALtztiECAKhjqHDDAKLqvL2DgLL162NAuuXD7GruHBdRrXkPc7LYMbw4lGylLaUTxAkpvK7MNEK" />
</div>
    <div class="box1">
        <div>
	<table class="tableStyle" cellspacing="0" id="gvEquUse" style="width:100%;border-collapse:collapse;">
		<tr>
			<th scope="col">设备名称</th><th scope="col">设备型号</th><th scope="col">系统编号</th><th scope="col">目前使用科室</th><th align="center" scope="col">使用时间</th><th scope="col">项目</th><th scope="col">使用次数</th><th scope="col">收费金额</th><th scope="col">合计</th>
		</tr><tr>
			<td>
                        <span id="gvEquUse_lblEquName_0" class="equname">金宝透析机</span>
                        <input name="gvEquUse$ctl02$hdPDID" type="hidden" id="gvEquUse_hdPDID_0" class="pkey" value="1118" />
                        <input type="hidden" class="DepartmentID" id="DepartmentID" value='30502' />
                    </td><td>AK96</td><td>6845-4151120532</td><td>检验科</td><td align="center">
                        <input name="gvEquUse$ctl02$txtUseDate" type="text" value="2016-01-15 11:23" id="gvEquUse_txtUseDate_0" class="UseDate date" dateFmt="yyyy-MM-dd HH:mm" style="width:100px;" />
                    </td><td>
                        <input name="gvEquUse$ctl02$txtUseProject" type="text" id="gvEquUse_txtUseProject_0" class="UseProject" />
                    </td><td>
                        <input name="gvEquUse$ctl02$txtUseNum" type="text" id="gvEquUse_txtUseNum_0" class="UseNum" onkeyup="Sum(this)" style="width:70px;" />
                    </td><td>
                        <input name="gvEquUse$ctl02$txtUseMoney" type="text" id="gvEquUse_txtUseMoney_0" class="UseMoney" onkeyup="Sum(this)" style="width:70px;" />
                    </td><td>
                        <span id="gvEquUse_lblSumMoney_0" class="SumMoney">0.00</span>
                    </td>
		</tr>
	</table>
</div>
        <table class="tableStyle" formmode="transparent">
            <tr>
                <td>
                    <button id="Button1" type="button" onclick="top.Dialog.close();" style="float: right;
                        margin-right: 50px">
                        <span class="icon_exit">返回</span></button>
                    <button id="btnSave" type="button" onclick="saveGrid();" style="float: right;
                        margin-right: 30px">
                        <span class="icon_save">保存</span></button>
                </td>
            </tr>
        </table>
    </div>
    </form>
</body>
</html>
