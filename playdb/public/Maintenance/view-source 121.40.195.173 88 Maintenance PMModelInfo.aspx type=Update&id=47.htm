

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>保养模版</title>
    <script type="text/javascript" src="../libs/js/jquery.js"></script>
    <script type="text/javascript" src="../libs/js/language/cn.js"></script>
    <script type="text/javascript" src="../libs/js/framework.js"></script>
    <link href="../libs/css/import_basic.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" id="skin" prepath="../" />
    <link rel="stylesheet" type="text/css" id="customSkin" />
    <link href="css/print.css" rel="stylesheet" type="text/css" />
    <link href="css/reset.css" rel="stylesheet" type="text/css" />
    <!--弹窗组件start-->
    <script type="text/javascript" src="../libs/js/popup/drag.js"></script>
    <script type="text/javascript" src="../libs/js/popup/dialog.js"></script>
    <!--弹窗组件end-->
    <!-- 树组件start -->
    <script type="text/javascript" src="../libs/js/tree/ztree/ztree.js"></script>
    <link type="text/css" rel="stylesheet" href="../libs/js/tree/ztree/ztree.css"></link>
    <!-- 树组件end -->
    <!-- 树形下拉框start -->
    <script type="text/javascript" src="../libs/js/form/selectTree.js"></script>
    <!-- 树形下拉框end -->
        <!-- 日期控件start -->
    <script type="text/javascript" src="../libs/js/form/datePicker/WdatePicker.js"></script>
    <!-- 日期控件end -->

    <script type="text/javascript">
        function Open() {
            top.Dialog.open({
                URL: "SearchPage/SelectEqument.aspx?Command=PMModelInfo",
                Title: "选择设备", ShowMaxButton: true, Width: 950, Height: 530
            });
        }

        function setvalue(ibNumber, EquName) {
            if (ibNumber != null) {
                $("#txtEquName").val(EquName);
                $("#hfIBNumber").val(ibNumber);
            }
        }
    </script>
</head>
<body>
    <input type="hidden" id="ID" name="ID" value='' />
    <div id="equsearch" style="height: 20; text-align: center;">
        <input name="hfCategoryID" type="hidden" id="hfCategoryID" />
        <input name="hfCategoryName" type="hidden" id="hfCategoryName" />
        <table class="tableStyle" formmode="view">
            <tr>
                <td width="50%">
                    设备分类：
                </td>
                <td width="50%">
                    <div class="selectTree" name="treeCategoryName" id="treeCategoryName" url="../Handler/WordBook.ashx?Command=Tree&ParentID=10000">
                    </div>
                    <span style="float: left; color: red">*</span>
                    <script type="text/javascript">
                        $("#treeCategoryName").bind("change", function () {
                            $("#hfCategoryID").val($(this).attr("relValue"));
                            $("#hfCategoryName").val($(this).attr("relText"));
                        })
                    </script>
                </td>
            </tr>
        </table>
    </div>
    <div id="print" class="print">
        <h1 id="headtitle">
            医疗设备保养报告单</h1>
        <table width="100%">
            <tbody>
                <tr>
                    <td colspan="6">
                        <span>一、设备基本概况</span>
                    </td>
                </tr>
               
                 <tr>
                    <td>
                        <span>是否保养完成</span>
                    </td>
                    <td colspan="5">
                        <div id="divIsComplete">
                       <input type="radio" name="isFinish" id="Fin" class="isFinish" onchange="radioFinish_change()"  value="完成"  />完成
                        <input type="radio" name="isFinish" id="NoFin" class="isFinish" onchange="radioFinish_change()"  value="未完成" checked="checked"/>未完成
                        </div>
                    </td>
                </tr>
                    <td>
                        <span>设备名称</span>
                    </td>
                    <td colspan="2">
                        <div id="DeviceName">
                        </div>
                    </td>
                    <td>
                        <span>系统编号</span>
                    </td>
                    <td colspan="2">
                        <div id="IBNO">
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <span>设备序列号</span>
                    </td>
                    <td colspan="2">
                        <div id="SNNo">
                        </div>
                    </td>
                    <td>
                        <span>设备分类</span>
                    </td>
                    <td colspan="2">
                        <div id="DeviceCate">
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <span>设备厂家</span>
                    </td>
                    <td colspan="2">
                        <div id="VenderName">
                        </div>
                    </td>
                    <td>
                        <span>PM 周期</span>
                    </td>
                    <td colspan="2">
                        <div id="PMperiod">
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <span>目前使用科室</span>
                    </td>
                    <td colspan="2">
                        <div id="Office">
                        </div>
                    </td>
                      <td>
                        <span>设备初始状态</span>
                    </td>
                    <td colspan="2">
                        <div id="StartState">
                        </div>
                    </td>
                </tr>
                 <tr>
                    <td>
                        <span>PM开始时间</span>
                    </td>
                    <td colspan="2">
                        <div id="PMDate" class="PMDate" onclick="SeachTime(this)">
                         &nbsp;
                        </div>
                        
                    </td>
                    <td>
                        <span>PM完成时间</span>
                    </td>
                    <td colspan="2">
                        <div id="PMDateEnd" class="PMDate" onclick="SeachTime(this)">
                         &nbsp;
                        </div>
                       
                    </td>
                </tr>
            </tbody>
            <tbody>
                <tr>
                    <td colspan="6">
                        <span>二、配件信息</span>
                    </td>
                </tr>
                 <tr>
                    <td >
                        <span>是否使用配件</span>
                    </td>
                    <td colspan="5">
                      <div  class="ISUsePart" id="ISUsePart"> &nbsp;</div>
                    </td>
                </tr>
            </tbody>
            <tbody id="part">
                <tr>
                    <td>
                        <span class="trPartnoHead">配件货号</span>
                    </td>
                    <td colspan="2">
                        <span class="trPartNameHead">配件名称</span>
                    </td>
                    <td>
                        <span class="trPartPriceHead">配件数量</span>
                    </td>
                    <td colspan="2">
                        <span class="abs-r"><a id="addRowPart" href="javascript:;">
                            <img src="img/add.png" name="imgpart" /></a></span> <span class="trPartPriceHead">配件金额</span>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div class="trPartno" onclick="CheckPart(this)">
                            &nbsp;</div>
                    </td>
                    <td colspan="2">
                        
                              <span class="trPartName">&nbsp;</span>
                    </td>
                    <td>
                    <div class="trPartCount">&nbsp;</div>
                    </td>
                    <td colspan="2">
                        <span class="abs-r"><a id="subRow" href="javascript:;">
                            <img src="img/sub.png" name="imgpart" id="subRowPart" /></a> </span>
                         
                             <span class="trPartPrice">&nbsp;</span>
                    </td>
                </tr>
            </tbody>
              <tbody>
                <tr>
                    <td colspan="6">
                        <span>三、费用信息</span>
                    </td>
                </tr>
            </tbody>
             <tbody id="Price">
                <tr>
                    <td>
                        <div class="trPMhourHead">
                            保养工时</div>
                    </td>
                    <td colspan="2">
                        <div class="trPersonPriceHead">
                            人工费用</div>
                    </td>
                    <td>
                        <div class="trPMPartPriceHead">
                            配件费用</div>
                    </td>
                    <td colspan="2">
                        
                        <div class="trPMPartPriceALLHead">
                            费用总计</div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div class="trPMhour">
                            &nbsp;</div>
                    </td>
                    <td colspan="2">
                        <div class="trPersonPrice">
                            &nbsp;</div>
                    </td>
                    <td>
                        <div class="trPMPartPrice">
                            &nbsp;</div>
                    </td>
                    <td colspan="2">
                        <div class="trPMPartPriceALL">
                            &nbsp;</div>
                    </td>
                </tr>
            </tbody>
            <tbody>
                <tr>
                    <td colspan="6">
                        <div name="addclickEventdom">
                            四、检查维护内容</div>
                    </td>
                </tr>
            </tbody>
            <tbody>
                <tr>
                    <td rowspan="6">
                        <span class="abs-l"><a id="subRowLeft" href="javascript:;">
                            <img src="img/sub.png" /></a> </span>
                        <div name="addclickEventdom">
                            日常保养</div>
                    </td>
                    <td colspan="3">
                        <div name="addclickEventdom">
                            检查内容</div>
                    </td>
                    <td colspan="2">
                        <span class="abs-r"><a id="addRow" href="javascript:;">
                            <img src="img/add.png" /></a></span>
                        <p>
                            PM 结果：(1)合格；(2)修复；(3)可用；(4)待修；</p>
                    </td>
                </tr>
                <tr>
                    <td colspan="3">
                        <div name="addclickEventdom">
                            电源插头及电源线无破损</div>
                    </td>
                    <td colspan="2">
                        <span class="abs-r"><a id="subRow" href="javascript:;">
                            <img src="img/sub.png" /></a> </span>
                        <div name="addclickEventdom">
                            &nbsp;</div>
                    </td>
                </tr>
                <tr>
                    <td colspan="3">
                        <div name="addclickEventdom">
                            旋钮和按键无松动或破损</div>
                    </td>
                    <td colspan="2">
                        <span class="abs-r"><a id="subRow" href="javascript:;">
                            <img src="img/sub.png" /></a> </span>
                        <div name="addclickEventdom">
                            &nbsp;</div>
                    </td>
                </tr>
                <tr>
                    <td colspan="3">
                        <div name="addclickEventdom">
                            电气、机械连接无断线或松动</div>
                    </td>
                    <td colspan="2">
                        <span class="abs-r"><a id="subRow" href="javascript:;">
                            <img src="img/sub.png" /></a></span><div name="addclickEventdom">
                                &nbsp;</div>
                    </td>
                </tr>
                <tr>
                    <td colspan="3">
                        <div name="addclickEventdom">
                            外观整洁，附件无明显缺陷或异常</div>
                    </td>
                    <td colspan="2">
                        <span class="abs-r"><a id="subRow" href="javascript:;">
                            <img src="img/sub.png" name="imgsub" /></a></span><div name="addclickEventdom">
                                &nbsp;</div>
                    </td>
                </tr>
                <tr>
                    <td colspan="3">
                        <div name="addclickEventdom">
                            设备是否有异音</div>
                    </td>
                    <td colspan="2">
                        <span class="abs-r"><a id="subRow" href="javascript:;">
                            <img src="img/sub.png" /></a></span><div name="addclickEventdom">
                                &nbsp;</div>
                    </td>
                </tr>
            </tbody>
            <tbody>
                <tr>
                    <td rowspan="4">
                        <span class="abs-l"><a id="subRowLeft" href="javascript:;">
                            <img src="img/sub.png" /></a></span><div name="addclickEventdom">
                                风险评估</div>
                    </td>
                    <td colspan="3">
                        <div name="addclickEventdom">
                            电气安全测试</div>
                    </td>
                    <td colspan="2">
                        <span class="abs-r"><a id="addRow" href="javascript:;">
                            <img src="img/add.png" /></a></span><div name="addclickEventdom">
                                &nbsp;</div>
                    </td>
                </tr>
                <tr>
                    <td colspan="3">
                        <div name="addclickEventdom">
                            各运动部件功能正常、无异常声响和震动</div>
                    </td>
                    <td colspan="2">
                        <span class="abs-r"><a id="subRow" href="javascript:;">
                            <img src="img/sub.png" /></a></span><div name="addclickEventdom">
                                &nbsp;</div>
                    </td>
                </tr>
                <tr>
                    <td colspan="3">
                        <div name="addclickEventdom">
                            影像结果合符临床要求</div>
                    </td>
                    <td colspan="2">
                        <span class="abs-r"><a id="subRow" href="javascript:;">
                            <img src="img/sub.png" /></a></span><div name="addclickEventdom">
                                &nbsp;</div>
                    </td>
                </tr>
                <tr>
                    <td colspan="3">
                        <div name="addclickEventdom">
                            影响其他设备运行</div>
                    </td>
                    <td colspan="2">
                        <span class="abs-r"><a id="subRow" href="javascript:;">
                            <img src="img/sub.png" /></a></span><div name="addclickEventdom">
                                &nbsp;</div>
                    </td>
                </tr>
            </tbody>
            <tbody>
                <tr>
                    <td rowspan="2">
                        <span class="abs-l"><a id="subRowLeft" href="javascript:;">
                            <img src="img/sub.png" /></a></span><div name="addclickEventdom">
                                异常处理</div>
                    </td>
                    <td colspan="3">
                        <div name="addclickEventdom">
                            机内灰尘清除、润滑、紧固</div>
                    </td>
                    <td colspan="2">
                        <span class="abs-r"><a id="addRow" href="javascript:;">
                            <img src="img/add.png" /></a></span><div name="addclickEventdom">
                                &nbsp;</div>
                    </td>
                </tr>
                <tr>
                    <td colspan="3">
                        <div name="addclickEventdom">
                            异常是否经常发生</div>
                    </td>
                    <td colspan="2">
                        <span class="abs-r"><a id="subRow" href="javascript:;">
                            <img src="img/sub.png" /></a></span><div name="addclickEventdom">
                                &nbsp;</div>
                    </td>
                </tr>
            </tbody>
            <tbody>
                <tr>
                    <td rowspan="3">
                        <span class="abs-l"><a id="subRowLeft" href="javascript:;">
                            <img src="img/sub.png" /></a></span><div name="addclickEventdom">
                                其他</div>
                    </td>
                    <td colspan="3">
                        <div name="addclickEventdom">
                            工作间温度、温度正常</div>
                    </td>
                    <td colspan="2">
                        <span class="abs-r"><a id="addRow" href="javascript:;">
                            <img src="img/add.png" /></a></span><div name="addclickEventdom">
                                &nbsp;</div>
                    </td>
                </tr>
                <tr>
                    <td colspan="3">
                        <div name="addclickEventdom">
                            网络连接正常</div>
                    </td>
                    <td colspan="2">
                        <span class="abs-r"><a id="subRow" href="javascript:;">
                            <img src="img/sub.png" /></a></span><div name="addclickEventdom">
                                &nbsp;</div>
                    </td>
                </tr>
                <tr>
                    <td colspan="3">
                        <div name="addclickEventdom">
                            电源是否安全</div>
                    </td>
                    <td colspan="2">
                        <span class="abs-r"><a id="subRow" href="javascript:;">
                            <img src="img/sub.png" /></a></span><div name="addclickEventdom">
                                &nbsp;</div>
                    </td>
                </tr>
            </tbody>
            <tbody>
                <tr>
                    <td>
                        <span class="abs-l"><a id="addAllRow" href="javascript:;">
                            <img src="img/add.png" /></a></span>
                            <div name="addclickEventdom">
                                设备保养后状态</div>
                    </td>
                    <td colspan="5">
                        <p>&nbsp;</p>
                    </td>
                </tr>
            </tbody>
            <tbody>
                <tr>
                    <td>
                        <div name="addclickEventdom">
                            备注</div>
                    </td>
                    <td colspan="5">
                        <p>&nbsp;</p>
                    </td>
                </tr>
            </tbody>
             <tbody>
                <tr>
                    <td>
                        <div name="addclickEventdom">
                            您对本次服务的评价：</div>
                    </td>
                    <td colspan="5">
                       <div id="divAccept">
                            <input type="radio" name="Accept" id="Radio1" class="Accept" value="1"  checked="checked" />优秀
                            <input type="radio" name="Accept" id="Radio2" class="Accept" value="2" />很好
                            <input type="radio" name="Accept" id="Radio3" class="Accept" value="3" />不错
                            <input type="radio" name="Accept" id="Radio4" class="Accept" value="4" />一般
                            <input type="radio" name="Accept" id="Radio5" class="Accept" value="5"  />有待提高
                        </div>
                    </td>
                </tr>
            </tbody>
            <tbody>
                <tr>
                    <td width="15%">
                        <div name="addclickEventdom" class="PMperson">
                            PM 人员</div>
                    </td>
                    <td width="18.33%">
                        <div name="addclickEventdom">
                            &nbsp;</div>
                    </td>
                    <td width="15%">
                        <div name="addclickEventdom">
                            使用部门</div>
                    </td>
                    <td width="18.33%">
                        <div name="addclickEventdom">
                            &nbsp;</div>
                    </td>
                    <td width="15%">
                        <div name="addclickEventdom" >
                            科室负责人</div>
                    </td>
                    <td width="18.33%">
                        <div name="addclickEventdom">
                            &nbsp;</div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="intro">
        <div name="addclickEventdom">
            <p>
                <span class="red">注意：</span>请填写模板名称，并设计PM 保养单模板后再提交。例如：模板名称"医用电子类设备PM模板"。</p>
        </div>
        <div style="margin-top: 5px;">
            <span style="float: left;">模板名称：</span>
            <input type="text" id="name" name="name" value="" style="float: left; width: 150px;" /><span
                style="float: left;">&nbsp</span>
            <input type="button" value="提交" class="btn-input button blue" id="submit" name="submit"
                style="float: left;" />

           
                
      
            
        </div>
    </div>
   



    <script type="text/javascript">
        function CheckPart(flag) { }
        function SeachTime(flag) { }

        function radioFinish_change() { }

    </script>

    <script>
        $(function () {
            $("#Radio1").attr("disabled", "disabled");
            $("#Radio2").attr("disabled", "disabled");
            $("#Radio3").attr("disabled", "disabled");
            $("#Radio4").attr("disabled", "disabled");
            $("#Radio5").attr("disabled", "disabled");    
        });
    
    </script>

    <script src="../libs/js/jquery-1.7.1.min.js" type="text/javascript"></script>
    <script type="text/javascript">

        var jq171 = jQuery.noConflict(true);
        (function ($) {
            var id = "47";
            var name = "sa";
            var type = "Update";
            if (name != "") {
                $("input[name=name]").val(name);
            }
            if (id != "0") {
                $("div#equsearch").hide();
                $("#hfCategoryID").val("0");
                $.ajax({
                    type: 'POST',
                    async: false,
                    url: "../Handler/PMModelHandler.ashx?type=GetModel",
                    dataType: 'text',
                    data: { "ID": id },
                    success: function (data) {
                        if (data != "") {
                            $("div#print").empty().append(data);

                            //$("img[name=imgadd]").hide();
                        } else {
                            top.Dialog.alert("数据加载失败！");
                        }
                    },
                    error: function () {
                        top.Dialog.alert('数据读取失败！');
                    }
                });
            }

            $("td div[name='addclickEventdom']").live('click', divClick);
            $("td p").bind('click', pClick);
            $("#ISUsePart").unbind("click");
            $("#ISUsePart").die("click");
         
            $("#PMDatebegin").hide();
            $("#PMDateend").hide();
            $("#divIsComplete").hide();
            $("#subRowPart").hide();
            $("#addRowPart").hide();
            $(".date").hide();
            
          
            //$("td div").live('click', divClick);k
          

            $("a#addRowPart").live('click', function () {
                $(this).parents('tbody').append('<tr ><td ><div class="trPartno">&nbsp;</div></td><td colspan="2"><div  class="trPartName">&nbsp;</div></td><td  ><div  class="trPartCount">&nbsp;</div></td><td colspan="2" ><span class="abs-r"><a href="javascript:;" id="subRow"><img src="img/sub.png" /></a></span><div  class="trPartPrice">&nbsp;</div></td></tr>');
            });

            $("a#addRowPrice").live('click', function () {
                $(this).parents('tbody').append('<tr ><td ><div class="trPMhour">&nbsp;</div></td><td colspan="2"><div  class="trPersonPrice">&nbsp;</div></td><td  ><div  class="trPMPartPrice">&nbsp;</div></td><td colspan="2" ><span class="abs-r"><a href="javascript:;" id="subRow"><img src="img/sub.png" /></a></span><div  class="trPMPartPriceALL">&nbsp;</div></td></tr>');
            });

            $("a#addRow").live('click', function () {
                $(this).parents('tbody').children('tr').children('td').first().attr('rowspan', parseInt($(this).parents('tbody').children('tr').children('td').first().attr('rowspan')) + 1);
                $(this).parents('tbody').append('<tr><td colspan="3"><div name="addclickEventdom">&nbsp;</div></td><td colspan="2"><span class="abs-r"><a href="javascript:;" id="subRow"><img src="img/sub.png" /></a></span><div name="addclickEventdom">&nbsp;</div></td></tr>');
            });
            $("a#subRow").live('click', function () {
                $(this).parents('tbody').children('tr').children('td').first().attr('rowspan', parseInt($(this).parents('tbody').children('tr').children('td').first().attr('rowspan')) - 1);
                $(this).parents('tr').remove();
            });
            $("a#subRowLeft").live('click', function () {
                $(this).parents('tbody').remove();
            });
            $("a#addAllRow").live('click', function () {
                $('<tbody><tr><td rowspan="1"><span class="abs-l"><a id="subRowLeft" href="javascript:;">  <img src="img/sub.png" name="imgsub" /></a></span><div name="addclickEventdom">&nbsp;</div></td><td colspan="3"><div name="addclickEventdom">&nbsp;</div></td><td colspan="2"><span class="abs-r"><a id="addRow" href="javascript:;"><img src="img/add.png"></a></span><div name="addclickEventdom">&nbsp;</div></td></tr></tbody>').insertBefore($(this).parents('tbody'));
            });


            //提交和保存操作
            $("#submit").click(function () {
                if ($("#hfCategoryID").val()) {
                    if ($("input[name=name]").val()) {
                        $.ajax({
                            type: 'POST',
                            async: false,
                            url: "../Handler/PMModelHandler.ashx?type=AddModel",
                            dataType: 'text',
                            data: { "data": $("div#print").html(), "name": $("input[name=name]").val(), "ID": id, "CategoryID": $("#hfCategoryID").val(), "CategoryName": $("#hfCategoryName").val(), "IBNO": $("#hfIBNumber").val(), "equname": $("#txtEquName").val(), "username": "系统管理员","Evaluate":$("input:radio[name=Accept]").filter("[checked]").val() },
                            success: function (data) {
                                if (data == "0") {
                                    top.Dialog.alert("保存成功！|保存成功", function () { top.frmright.page_300.refresh(); top.Dialog.close(); });
                                }
                                else if (data == "2") {
                                    top.Dialog.alert("修改成功！|修改成功", function () { top.frmright.page_300.refresh(); top.Dialog.close(); });
                                }
                                else if (data == "1") {

                                    top.Dialog.alert("保存失败!");
                                }
                                else if (data == "3") {
                                    top.Dialog.alert("修改失败!");
                                }
                            },
                            error: function () {
                                top.Dialog.alert('数据读取失败!');
                            }
                        });
                    }
                    else {
                        $("input[name=name]").focus();
                        top.Dialog.alert('请输入模板名称，然后再提交！');
                    }
                }
                else {
                    //$("input[name=txtEquName]").focus();
                    top.Dialog.alert('请选择设备分类，然后再提交！');
                }
                return false;
            });


            //日期格式验证
            function IsDate(str) {
                var flag = "OK"
                if ($.trim(str).length != 0) {
                    var reg = /^(?:(?!0000)[0-9]{4}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-8])|(?:0[13-9]|1[0-2])-(?:29|30)|(?:0[13578]|1[02])-31)|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)-02-29)$/;
                    var r = str.match(reg);
                    if (r == null) {
                        flag = "NO";
                        top.Dialog.alert('日期格式不正确！ 可输入的格式例如：2015-01-01 ')
                    };
                }
                else {
                    flag = "NO";
                }
                return flag;
            }

            function divClick() {
                //div 点击时取出值，赋给新追加的input
                var td = $(this);
                var tdText = $.trim(td.text());
                var inputtext = td.children("input");
                if (tdText == "") {
                    tdText = $.trim(inputtext.val());
                }

                td.empty();
                var input = $("<input>");
                input.attr("value", tdText);
                input.width('100%');
                input.height('100%');
                td.append(input);
                input.focus();

                input.blur(function () {
                    var input = $(this);
                    var inputText = input.val();
                    var div = input.parent("div");
                    td.html(inputText.length > 0 ? inputText : '&nbsp;');
                    div.live('click', divClick);
                });
                input.keyup(function (event) {
                    var myEvent = event || window.event;
                    var keyCode = myEvent.keyCode;
                    if (keyCode == 27) { input.val(tdText); }
                });

                var inputDom = input.get(0);
                inputDom.select();
                td.unbind("click");
            };
            function pClick() {
                var td = $(this);
                var tdText = $.trim(td.text());
                var inputtext = td.children("input");
                if (tdText == "") {
                    tdText = $.trim(inputtext.val());
                }
                td.empty();
                var input = $("<textarea>");
                input.text(tdText);
                input.width('100%');
                input.height('100%');
                td.append(input);
                input.focus();
                input.blur(function () {
                    var input = $(this);
                    var inputText = input.val();
                    var td = input.parent("p");
                    td.html(inputText.length > 0 ? inputText : '&nbsp;');
                    td.bind('click', pClick);
                });
                input.keyup(function (event) {
                    var myEvent = event || window.event;
                    var keyCode = myEvent.keyCode;
                    if (keyCode == 27) { input.val(tdText); }
                });
                var inputDom = input.get(0);
                inputDom.select();
                td.unbind("click");
            };
        })(jq171);






    </script>
</body>
</html>
