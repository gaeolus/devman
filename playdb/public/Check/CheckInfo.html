

<!DOCTYPE html />
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>计量管理</title>
    <!--框架必需start-->
    <script type="text/javascript" src="../libs/js/jquery.js"></script>
    <script type="text/javascript" src="../libs/js/language/cn.js"></script>
    <script type="text/javascript" src="../libs/js/framework.js"></script>
    <link href="../libs/css/import_basic.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" id="skin" prepath="../" />
    <link rel="stylesheet" type="text/css" id="customSkin" />
    <!--框架必需end-->
    <!-- 日期控件start -->
    <script type="text/javascript" src="../libs/js/form/datePicker/WdatePicker.js"></script>
    <!-- 日期控件end -->
    <!-- 树组件start -->
    <script type="text/javascript" src="../libs/js/tree/ztree/ztree.js"></script>
    <link type="text/css" rel="stylesheet" href="../libs/js/tree/ztree/ztree.css"></link>
    <!-- 树组件end -->
    <!-- 树形下拉框start -->
    <script type="text/javascript" src="../libs/js/form/selectTree.js"></script>
    <!-- 树形下拉框end -->
    <!-- 表单验证start -->
    <script src="../libs/js/form/validationRule.js" type="text/javascript"></script>
    <script src="../libs/js/form/validation.js" type="text/javascript"></script>
    <!-- 表单验证end -->
    <script type="text/javascript">

        function initComplete() {
            $("#CategoryID").bind("change", function () {
                $("#hfdCategoryID").val($(this).attr("relValue"));
            })
        }
        $(function () {
            var flag = true;
            $("#LookPjName").click(function () {
                if ($("#txtIBNumber").val() == "" || $("#txtIBNumber").val() == undefined) {
                    alert("请先选择设备名称！");
                    flag = false;
                }
                else
                    flag = true;
                if (flag) {
                    top.Dialog.open({
                        URL: "SearchPage/Selectionofspareparts.aspx?IBNumber=" + $("#txtIBNumber").val(),
                        Title: "选择备件信息",
                        ShowMaxButton: true,
                        Width: 750,
                        Height: 430
                    });
                }
            })
            $("#btnCancel").click(function () {
                //top.frmright.page_246.refresh();
                top.Dialog.close();
            })

        });
        $(function () {
            $("#lookUP").click(function () {
                top.Dialog.open({
                    URL: "SearchPage/SelectEqument.aspx?Command=CheckInfo",
                    Title: "选择医院设备",
                    ShowMaxButton: true,
                    Width: 950,
                    Height: 530
                });
            })
            $("#btnCancel").click(function () {
                //top.frmright.page_246.refresh();
                top.Dialog.close();
            })

            $("#btnSave").click(function () {
                var valid = $("#myFormId").validationEngine({ returnIsValid: true });
                if (GetEntity().CheckProduct == "备件") {
                    if (GetEntity().PartName == "") {
                        top.Dialog.alert("请选择备件！");
                        valid = false;
                    }
                    else
                        valid = true;
                }
                if (valid == true) {
                    var checkinfo = GetEntity();
                    $.ajax({
                        type: 'POST',
                        async: false,
                        url: '../Handler/CheckInfo.ashx',
                        dataType: 'json',
                        data: {
                            type: "Save",
                            data: checkinfo
                        },
                        success: function (result) {
                            top.frmright.page_246.refresh();
                            top.Dialog.close();
                        },
                        error: function (a) {
                            top.Dialog.alert("访问服务器端出错！");
                        }
                    });
                }

            })
        })

        function GetEntity() {
            if ($("#txtBookSn").val() == "") {
                top.Dialog.alert("请输入证书编号！");
                return false;
            }

            var checkinfo = {};
            checkinfo.ID = $("#hdID").val(); //
            checkinfo.BookSn = $("#txtBookSn").val(); //证书编号
            checkinfo.IBNumber = $("#txtIBNumber").val(); // 系统编号
            checkinfo.DepID = $("#hdDeptID").val();
            checkinfo.Money = $("#txtMoney").val();
            checkinfo.CheckTime = $("#txtCheckTime").val();
            checkinfo.NextTime = $("#txtNextTime").val();
            checkinfo.Result = $("#txtResult").val();
            checkinfo.Manager = $("#txtManager").val();
            checkinfo.Checker = $("#txtChecker").val();
            checkinfo.Tester = $("#txtTester").val();
            checkinfo.CheckProduct = $("#ddlCheckProduct").val();
           
            
            checkinfo.State = $("#rblState").attr("checked") == true ? '0' : '1';
            checkinfo.Remark = $("#txtRemark").val();
            checkinfo.PartNo = $("#txtPartsArtNo").val();
            checkinfo.SerialNo = $("#txtPartsSerialNo").val();
            checkinfo.PartName = $("#txtPartsName").val();
            return checkinfo;
        }
        $(function () {
            $("#ddlCheckProduct").bind("keyup change", function () {
                if ($(this).val() == "整机") {
                    $("#peijianNo").hide();
                    $("#peijian").hide();
                } else {
                    $("#peijianNo").show();
                    $("#peijian").show();
                }
            })
        })
     
    </script>
</head>
<body>
    <form method="post" action="CheckInfo.aspx?type=Add" id="myFormId" target="frmright">
<div class="aspNetHidden">
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwUKMTU3MzY2MDAzOQ9kFgJmD2QWAgIdDxAPFgYeDURhdGFUZXh0RmllbGQFCFdvcmROYW1lHg5EYXRhVmFsdWVGaWVsZAUIV29yZE5hbWUeC18hRGF0YUJvdW5kZ2QQFQMNLS3or7fpgInmi6ktLQzmo4DmtYvlkIjmoLwP5qOA5rWL5LiN5ZCI5qC8FQMADOajgOa1i+WQiOagvA/mo4DmtYvkuI3lkIjmoLwUKwMDZ2dnZGRkCTbfHIStY2KJe0+CV5VQtDvydd9eFsjBeY8Q0MFL7h0=" />
</div>

<div class="aspNetHidden">

	<input type="hidden" name="__EVENTVALIDATION" id="__EVENTVALIDATION" value="/wEWGwLw567eCgKEs4q7AgKugaO2DQKFzL3mCwK17crhAQK83LDBDALVmdGhAQKzkffwAwKhltH8DQKpjbTGDgL89eSLAQLW3pf6DgKf3eqNCAKcwbGXAQLChNiQDALkub6rDQKZlrG7DgL6g4f3AwKI2/znAgLq9rbvDgKbu9e0CwK85t+JAQLZmpXbA2YC7ojI4g0CmbyL5QQCnLe4kgxXl2/bCnZz/7nRshHhzoLSYXqifdV5/SOTu9SpZEW83Q==" />
</div>
    <table class="tableStyle" formmode="view">
        <tr>
            <td>
                证书编号：
            </td>
            <td>
                <input name="txtBookSn" type="text" id="txtBookSn" class="validate[required]" /><span
                    class="star">*</span>
            </td>
            <td>
                设备名称：
            </td>
            <td>
                <input name="txtEquName" type="text" id="txtEquName" class="validate[required]" />
                <input type="hidden" name="hdDeptID" id="hdDeptID" />
                <input type="hidden" name="hdID" id="hdID" />
                <span class="icon_find" id="lookUP">&nbsp;</span><span class="star">*</span>
            </td>
        </tr>
        <tr>
            <td>
                设备型号：
            </td>
            <td>
                <input name="txtSpecification" type="text" id="txtSpecification" disabled="disabled" class="aspNetDisabled" />
            </td>
            <td>
                设备厂家：
            </td>
            <td>
                <input name="txtFactory" type="text" id="txtFactory" disabled="disabled" class="aspNetDisabled" />
            </td>
        </tr>
        <tr>
            <td>
                系统编号：
            </td>
            <td>
                <input name="txtIBNumber" type="text" id="txtIBNumber" disabled="disabled" class="aspNetDisabled" />
            </td>
            <td>
                目前使用科室：
            </td>
            <td>
                <input name="txtDeptName" type="text" id="txtDeptName" disabled="disabled" class="aspNetDisabled" />
            </td>
        </tr>
        <tr>
            <td>
                检测产品：
            </td>
            <td colspan="3">
                <select name="ddlCheckProduct" id="ddlCheckProduct" class="validate[required]">
	<option value="整机">整机</option>
	<option value="备件">备件</option>

</select>
            </td>
        </tr>
        <tr id="peijianNo" style="display: none">
	<td>
                配件名称：
            </td>
	<td colspan="3">
                <input name="txtPartsName" type="text" id="txtPartsName" />
                <span class="icon_find" id="LookPjName">&nbsp;</span><span class="star">*</span>
            </td>
</tr>

        <tr id="peijian" style="display: none">
	<td>
                配件货号：
            </td>
	<td>
                <input name="txtPartsArtNo" type="text" id="txtPartsArtNo" />
            </td>
	<td>
                配件序列号：
            </td>
	<td>
                <input name="txtPartsSerialNo" type="text" id="txtPartsSerialNo" />
            </td>
</tr>

        <tr>
            <td>
                费用：
            </td>
            <td>
                <input name="txtMoney" type="text" value="0" id="txtMoney" class="numinput validate[required,custom[onlyNumberWide]]" />
            </td>
            <td>
                检测时间：
            </td>
            <td>
                <input name="txtCheckTime" type="text" id="txtCheckTime" class="date" class="validate[required]" dateFmt="yyyy-MM-dd HH:mm" />
            </td>
        </tr>
        <tr>
            <td>
                下次检测时间：
            </td>
            <td>
                <input name="txtNextTime" type="text" id="txtNextTime" class="date" dateFmt="yyyy-MM-dd HH:mm" />
            </td>
            <td>
                检测结论：
            </td>
            <td>
                <select name="txtResult" id="txtResult" class="validate[required]">
	<option value="">--请选择--</option>
	<option value="检测合格">检测合格</option>
	<option value="检测不合格">检测不合格</option>

</select>
            </td>
        </tr>
        <tr>
            <td>
                主管人：
            </td>
            <td>
                <input name="txtManager" type="text" id="txtManager" />
            </td>
            <td>
                审核人：
            </td>
            <td>
                <input name="txtChecker" type="text" id="txtChecker" />
            </td>
        </tr>
        <tr>
            <td>
                检定人：
            </td>
            <td>
                <input name="txtTester" type="text" id="txtTester" />
            </td>
            <td>
                处理状态：
            </td>
            <td>
                <span class="aspNetDisabled"><input id="rblState" type="radio" name="rblState" value="rblState" checked="checked" disabled="disabled" /></span>未检测
                <span class="aspNetDisabled"><input id="rblState1" type="radio" name="rblState" value="rblState1" disabled="disabled" /></span>已检测
            </td>
        </tr>
        <tr>
            <td>
                备注：
            </td>
            <td colspan="3" style="white-space: normal; word-wrap: break-word; word-break: break-all;">
                <textarea name="txtRemark" rows="2" cols="20" id="txtRemark" style="height:40px;width:400px;">
</textarea>
            </td>
        </tr>
        <tr>
            <td colspan="4">
                <input name="btnSave" type="button" id="btnSave" value="保存" />
                <input type="button" value="取消" id="btnCancel" />
            </td>
        </tr>
    </table>
    </form>
</body>
</html>
