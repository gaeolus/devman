

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head><title>
	配件信息
</title>
    <!--框架必需start-->
    <script src="../libs/js/jquery.js" type="text/javascript"></script>
    <script type="text/javascript" src="../libs/js/language/cn.js"></script>
    <script type="text/javascript" src="../libs/js/framework.js"></script>
    <link href="../libs/css/import_basic.css" rel="stylesheet" type="text/css" /><link id="skin" rel="stylesheet" type="text/css" prepath="../" /><link id="customSkin" rel="stylesheet" type="text/css" />
    <!--框架必需end-->
    <!-- 日期控件start -->
    <script type="text/javascript" src="../libs/js/form/datePicker/WdatePicker.js"></script>
    <!-- 日期控件end -->
    <!-- 树组件start -->
    <script type="text/javascript" src="../libs/js/tree/ztree/ztree.js"></script>
    <link type="text/css" rel="stylesheet" href="../libs/js/tree/ztree/ztree.css" /></link>
    <!-- 树组件end -->
    <!-- 树形下拉框start -->
    <script type="text/javascript" src="../libs/js/form/selectTree.js"></script>
    <!-- 树形下拉框end -->
    <!-- 表单验证start -->
    <script src="../libs/js/form/validationRule.js" type="text/javascript"></script>
    <script src="../libs/js/form/validation.js" type="text/javascript"></script>
    <!-- 表单验证end -->
    <script src="../libs/js/form/suggestion.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(function () {
            // 厂商赋值
            if ('Add' == "Edit" || 'Add' == "Look") {
                $("#ddlFactory").attr("selectedvalue", '');
            }
            //绑定厂商
            $.post("../Handler/Factory.ashx", { Type: "GetFacoryNames" }, function (result) {
                $("#ddlFactory").data("data", result);
                $("#ddlFactory").render();
            }, "json");
        })
        function reflesh() {
            top.frmright.page_291.refresh();
            top.Dialog.close();
        }
        //获取基本信息对象
        function getObjInfo() {
            var obj = new Object();
            if ('Add' == "Edit") {
                obj.Id = "";
            }
            obj.PartCategory = $("#txtPartCategory").val();
            obj.PartName = $("#txtPartName").val();
            obj.PartModel = $("#txtPattModel").val();
            obj.PartNum = $("#txtPartNum").val();
            obj.PartPrice = $("#txtPartPrice").val();
            obj.PartFactory = $('#ddlFactory').val();
            obj.PartFactoryLink = $("#txtLink").val();
            obj.Quantity = $('#txtQuantity').val();
            obj.InDate = $("#txtInDate").val();
            obj.CreateName = '系统管理员'
            obj.CreateTime = '2016/1/11 15:12:07';

            obj.UpdateName = "系统管理员";
            obj.UpdateTime = "2016/1/11 15:12:07";
            return obj;
        }
        function Save() {
            var valid = $("#form1").validationEngine({ returnIsValid: true });
            if (valid == true) {
                objInfo = JSON.stringify(getObjInfo());
                var postData = { objInfo: objInfo };
                var Url = "../Handler/PartLibrary.ashx?Type=Add&t=" + Date.parse(new Date());
                $.ajax({
                    url: Url,
                    data: postData,
                    dataType: 'text',   //返回的数据类型
                    type: "POST",       //请求方式
                    async: false,
                    cache: false,
                    contentType: "application/x-www-form-urlencoded",
                    success: function (result) {
                        if (result == "ok") {
                            alert("操作成功！");
                            top.frmright.page_305.refresh();
                            top.Dialog.close();
                        }
                    },
                    error: function (result) {
                        //  alert(Url);
                        alert("数据传输错误");
                    }
                })
            }
        }
        function checkPercent() {
            var PartNo = $("#txtPattModel").val();
            var PartID="";
            if ('Add' == "Edit") {
                PartID = "";
            }
            if ($.trim(PartNo) != "" && $.trim(PartNo) != null) {
                $.ajax({
                    url: '../Handler/PartLibrary.ashx',
                    dataType: 'text',   //返回的数据类型
                    data: { PartNo: PartNo, Type: "GetNum", PartID: PartID },
                    async: false,
                    cache: false,
                    contentType: "application/x-www-form-urlencoded",
                    success: function (result) {
                        if (result == "OK") {
                            alert("此配件货号已经存在，请确认之后重新输入");
                            $("#txtPattModel").val("");
                        }
                    },
                    error: function (result) {
                        alert("数据连接错误");
                    }
                })  //ajax end
            }
        }
        function reflesh() {
            top.frmright.page_305.refresh();
            top.Dialog.close();
        }
    </script>
</head>
<body>
    <form method="post" action="PartLibraryAdd.aspx?Type=Add" id="form1">
<div class="aspNetHidden">
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwUJNzYwMDA4OTA4ZGRYgt1EX09Cz1wovM/TC45KazctMiu/5jlxgmP6Tgd/cQ==" />
</div>

<div class="aspNetHidden">

	<input type="hidden" name="__EVENTVALIDATION" id="__EVENTVALIDATION" value="/wEWCQK8n4iOCgKdldnkCALSzNHQBAKfldmTBALUmZn9AgKsjJiGAQL/tILBBQK4u+OMBgLKoMrZDxF16rtKNTGNZ3mgYebFduvI6IXCf3cdibHtOPollNmd" />
</div>
    <table class="tableStyle" formmode="view">
        <tr>
            <td width="100" align="right">
                配件名称：
            </td>
            <td align="left">
                <input name="txtPartName" type="text" id="txtPartName" class="validate[required]" />
                <span style="color: red">*</span>
            </td>
           </tr>
            <tr>
                <td width="100" align="right">
                    配件分类：
                </td>
                <td align="left">
                    <input name="txtPartCategory" type="text" id="txtPartCategory" />
                </td>
            </tr>
            <tr>
                <td width="100" align="right">
                    配件货号：
                </td>
                <td align="left"> 
                    <input name="txtPattModel" type="text" id="txtPattModel" class="validate[required]" onblur="checkPercent()" />
                    <span style="color: red">*</span>
                </td>
            </tr>
            <tr>
                <td width="100" align="right">
                    配件序列号：
                </td>
                <td align="left">
                    <input name="txtPartNum" type="text" id="txtPartNum" class="validate[required]" />
                    <span style="color: red">*</span>
                </td>
            </tr>
            <tr>
                <td width="100" align="right">
                    配件单价：
                </td>
                <td align="left">
                    <input name="txtPartPrice" type="text" id="txtPartPrice" onkeyup="if(isNaN(value))execCommand(&#39;undo&#39;)" onafterpaste="if(isNaN(value))execCommand(&#39;undo&#39;)" />
                </td>
            </tr>
             <tr>
                <td width="100" align="right">
                    数量：
                </td>
                <td align="left">
                    <input name="txtQuantity" type="text" id="txtQuantity" class="validate[required]" onkeyup="if(isNaN(value))execCommand(&#39;undo&#39;)" onafterpaste="if(isNaN(value))execCommand(&#39;undo&#39;)" />
                      <span style="color: red">*</span>
                </td>
            </tr>
             <tr>
                <td width="100" align="right">
                    入库日期：
                </td>
                <td align="left">
                    <input name="txtInDate" type="text" id="txtInDate" class="date" />
                </td>
            </tr>
            <tr>
                <td width="100" align="right">
                    设备厂家：
                </td>
                <td>
                    <div id="ddlFactory" class="suggestion validate[required]" keepdefaultstyle="true" showlist="true">
                    </div>
                    <span style="color: red">*</span>
                </td>
            </tr>
            <tr>
                <td width="100" align="right">
                    厂家联系人：
                </td>
                <td align="left">
                    <input name="txtLink" type="text" id="txtLink" />
                </td>
            </tr>

        <tr>
            <td colspan="2">
                <button id="btnSave" type="button" onclick="Save();" style="align: center; margin-right: 20px">
                    <span class="icon_save">保存</span></button>
                <input type="button" id="Button1" value="返 回" onclick="reflesh();" />
            </td>
        </tr>
    </table>
    </form>
</body>
</html>
